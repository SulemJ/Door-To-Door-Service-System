 html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bookings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/userBookings.css">
    <link rel="stylesheet" href="styles/Networking&MaintS.css" />
    <!-- Add to head section of both files -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
  .card.shadow-sm {
    border-radius: 8px;
    min-height: 200px;
  }

  .card .btn-link {
    font-size: 0.875rem;
  }

  .message-preview {
    display: inline;
  }
</style>

</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
          <a class="navbar-brand" href="index.html">
            <i class="fas fa-tools me-2"></i>
            MaintenanceHub
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link" href="index.html">Home</a>
              </li>
              <!-- <li class="nav-item">
                <a class="nav-link " href="NetworkingS.html">Networking</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="MaintenanceS.html">Maintenance</a>
              </li> -->
              <li class="nav-item">
                <a class="nav-link" href="/myPosts">My posts</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="AllserviceProviders.html">Service Providers</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/postJob">post a Job</a>
              </li>
              <li class="nav-item"  id="logoutBtn" >
                <a class="nav-link" >Log Out</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

<body>
    

    
    <main>
      
      <% for(let job of jobs) { %> 
  <section class="py-5 text-center container mt-5">
<div class="container my-4">
  <div class="card shadow-sm border " style="border-radius: 10px;">
    <div class="card-body">
      <h3 class="card-title"><%= job.title %></h3>
      <p class="card-text text-muted"><%= job.description %></p>
      <p><strong>Address:</strong> <%= job.address %></p>
      <p><strong>Duration:</strong> <%= job.duration %></p>

      <!-- Delete Button Bottom Right -->
      <div class="d-flex justify-content-end">
        <form action="/delete-job/<%= job.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this job?');">
          <button class="btn btn-danger btn-sm">Delete Job</button>
        </form>
      </div>
    </div>
  </div>
</div>


    <!-- Proposals for this job -->
    <div class="album py-3 bg-light">
      <div class="container">
        <% if (job.proposals.length === 0) { %>
          <p class="text-muted">No proposals submitted yet.</p>
        <% } else { %>
          <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
            <% job.proposals.forEach(proposal => { %>
              <div class="col">
                <div class="card shadow-sm">
                  <div class="card-body">
                    <h5 class="card-title">Proposal by User ID: <%= proposal.user_id %></h5>
                    <!-- <p class="card-text"><strong>Message:</strong> proposal.message %></p> -->
                    <p class="card-text">
                      <strong>Message:</strong>
                      <span class="message-preview" data-full="<%= proposal.message.replace(/"/g, '&quot;') %>">
                        <%= proposal.message.length > 50 ? proposal.message.slice(0, 50) + '...' : proposal.message %>
                      </span>
                      <% if (proposal.message.length > 50) { %>
                        <button class="btn btn-link btn-sm p-0 toggle-message">Show More</button>
                      <% } %>
                    </p>

                    <p><strong>Price:</strong> $<%= proposal.price %></p>
                    <p><strong>Status:</strong> <%= proposal.status %></p>
                    <p><strong>Submitted at:</strong> <%= new Date(proposal.submitted_at).toLocaleString() %></p>
                  <form action="/update-proposal-status/<%= proposal.id %>" method="POST" class="d-inline">
                      <input type="hidden" name="status" value="accepted">
                      <button class="btn btn-success btn-sm" type="submit" <%= proposal.status === 'accepted' ? 'disabled' : '' %>>Accept</button>
                    </form>

                    <form action="/update-proposal-status/<%= proposal.id %>" method="POST" class="d-inline">
                      <input type="hidden" name="status" value="rejected">
                      <button class="btn btn-warning btn-sm" type="submit" <%= proposal.status === 'rejected' ? 'disabled' : '' %>>Reject</button>
                  </form>

                  </div>
                </div>
              </div>
            <% }) %>
          </div>
        <% } %>
      </div>
    </div>
  </section>
<% } %>

    </main>
    

    
    
        <script src="/docs/5.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    
          
      <script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggleButtons = document.querySelectorAll('.toggle-message');

    toggleButtons.forEach(button => {
      button.addEventListener('click', () => {
        const span = button.previousElementSibling;
        const fullText = span.getAttribute('data-full');

        if (button.textContent === 'Show More') {
          span.textContent = fullText;
          button.textContent = 'Show Less';
        } else {
          span.textContent = fullText.slice(0, 50) + '...';
          button.textContent = 'Show More';
        }
      });
    });
  });
</script>

    
</body>
</html>
























      <% for(let job of jobs) { %>
        <div class="job-card card border-0 p-3">
          <div class="card-body">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center">
              <div>
                <h3 class="card-title mb-2"><%= job.title %></h3>
                <p class="card-text text-muted mb-1"><%= job.description %></p>
                <div class="mb-2">
                  <span class="badge bg-primary bg-opacity-10 text-primary me-2"><i class="fas fa-map-marker-alt me-1"></i> <%= job.address %></span>
                  <span class="badge bg-success bg-opacity-10 text-success"><i class="fas fa-clock me-1"></i> <%= job.duration %></span>
                </div>
              </div>
              <div class="mt-3 mt-md-0">
                <form action="/delete-job/<%= job.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this job?');">
                  <button class="btn btn-danger btn-sm"><i class="fas fa-trash-alt me-1"></i>Delete Job</button>
                </form>
              </div>
            </div>
          </div>
          <!-- Proposals for this job -->
          <div class="px-3 pb-3">
            <h6 class="fw-bold mt-3 mb-2 text-secondary">Proposals</h6>
            <% if (job.proposals.length === 0) { %>
              <div class="alert alert-light border text-muted mb-0">No proposals submitted yet.</div>
            <% } else { %>
              <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
                <% job.proposals.forEach(proposal => { %>
                  <div class="col">
                    <div class="proposal-card card border-0 shadow-sm h-100">
                      <div class="card-body">
                        <h5 class="card-title mb-2"><i class="fas fa-user-circle me-1"></i> User ID: <%= proposal.user_id %></h5>
                        <p class="card-text mb-1">
                          <strong>Message:</strong>
                          <span class="message-preview" data-full="<%= proposal.message.replace(/"/g, '&quot;') %>">
                            <%= proposal.message.length > 50 ? proposal.message.slice(0, 50) + '...' : proposal.message %>
                          </span>
                          <% if (proposal.message.length > 50) { %>
                            <button class="btn btn-link btn-sm p-0 toggle-message">Show More</button>
                          <% } %>
                        </p>
                        <p class="mb-1"><strong>Price:</strong> <span class="text-success">$<%= proposal.price %></span></p>
                        <p class="mb-1"><strong>Status:</strong>
                          <% if (proposal.status === 'accepted') { %>
                            <span class="badge bg-success">Accepted</span>
                          <% } else if (proposal.status === 'rejected') { %>
                            <span class="badge bg-danger">Rejected</span>
                          <% } else { %>
                            <span class="badge bg-secondary">Pending</span>
                          <% } %>
                        </p>
                        <p class="mb-2"><strong>Submitted:</strong> <%= new Date(proposal.submitted_at).toLocaleString() %></p>
                        <div>
                          <form action="/update-proposal-status/<%= proposal.id %>" method="POST" class="d-inline">
                            <input type="hidden" name="status" value="accepted">
                            <button class="btn btn-success btn-sm mb-1" type="submit" <%= proposal.status === 'accepted' ? 'disabled' : '' %>>
                              <i class="fas fa-check"></i> Accept
                            </button>
                          </form>
                          <form action="/update-proposal-status/<%= proposal.id %>" method="POST" class="d-inline">
                            <input type="hidden" name="status" value="rejected">
                            <button class="btn btn-warning btn-sm mb-1" type="submit" <%= proposal.status === 'rejected' ? 'disabled' : '' %>>
                              <i class="fas fa-times"></i> Reject
                            </button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                <% }) %>
              </div>
            <% } %>
          </div>
        </div>
      <% } %>
      
      <!-- Pagination -->
      <nav aria-label="Job posts pagination">
        <ul class="pagination">
          <% if (currentPage > 1) { %>
            <li class="page-item">
              <a class="page-link" href="?page=<%= currentPage - 1 %>">&laquo; Prev</a>
            </li>
          <% } else { %>
            <li class="page-item disabled">
              <span class="page-link">&laquo; Prev</span>
            </li>
          <% } %>
          <% for (let i = 1; i <= totalPages; i++) { %>
            <li class="page-item <%= i === currentPage ? 'active' : '' %>">
              <a class="page-link" href="?page=<%= i %>"><%= i %></a>
            </li>
          <% } %>
          <% if (currentPage < totalPages) { %>
            <li class="page-item">
              <a class="page-link" href="?page=<%= currentPage + 1 %>">Next &raquo;</a>
            </li>
          <% } else { %>
            <li class="page-item disabled">
              <span class="page-link">Next &raquo;</span>
            </li>
          <% } %>
        </ul>
      </nav>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script src="/docs/5.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const toggleButtons = document.querySelectorAll('.toggle-message');
        toggleButtons.forEach(button => {
          button.addEventListener('click', () => {
            const span = button.previousElementSibling;
            const fullText = span.getAttribute('data-full');
            if (button.textContent === 'Show More') {
              span.textContent = fullText;
              button.textContent = 'Show Less';
            } else {
              span.textContent = fullText.slice(0, 50) + '...';
              button.textContent = 'Show More';
            }
          });
        });
      });
    </script>
</body>
</html>













        <div>
          <h3 class="card-title mb-2"><%= job.title %></h3>
          <p class="card-text text-muted mb-1"><%= job.description %></p>
          <div class="mb-2">
            <span class="badge bg-primary bg-opacity-10 text-primary me-2"><i class="fas fa-map-marker-alt me-1"></i> <%= job.address %></span>
            <span class="badge bg-success bg-opacity-10 text-success"><i class="fas fa-clock me-1"></i> <%= job.duration %></span>
          </div>
        </div>







          <select name="category" id="category" class="form-control" required>
    <option value="">Select category</option>
    <% categories.forEach(cat => { %>
      <option value="<%= cat.name %>"><%= cat.name %></option>
    <% }) %>
    <option value="other">Other</option>
  </select>









  
    categorySelect.addEventListener('change', function() {
      const selected = this.value;
      const selectedIndex = categorySelect.selectedIndex;
      const selectedOption = categorySelect.options[selectedIndex];
      categoryNameInput.value = selectedOption.textContent;
      if (selected === 'other') {
        otherCategoryContainer.style.display = '';
        subcategoryContainer.style.display = 'none';
        otherSubcategoryContainer.style.display = 'none';
      } else if (selected) {
        otherCategoryContainer.style.display = 'none';
        subcategoryContainer.style.display = '';
        // Filter subcategories for this category
        const filtered = allSubcategories.filter(sc => sc.category_id == selected);
        // Clear and repopulate subcategory select
        subcategorySelect.innerHTML = '<option value="">Select subcategory</option>';
        filtered.forEach(sc => {
          // Use sc.name as value instead of sc.id
          subcategorySelect.innerHTML += `<option value="${sc.name}">${sc.name}</option>`;
        });
        subcategorySelect.innerHTML += `<option value="other">Other</option>`;
        otherSubcategoryContainer.style.display = 'none';
      } else {
        subcategoryContainer.style.display = 'none';
        otherCategoryContainer.style.display = 'none';
        otherSubcategoryContainer.style.display = 'none';
      }
    });





        <p><strong>Posted By:</strong> <%= locals.job.user_id %></p>

          <% if (locals.job.doc) { %>
      <div class="job-attachment">
        <p>
          <strong>Attachment:</strong>
          <a href="<%= locals.job.doc %>" download>Download</a>
        </p>
      </div>
      <% } %>